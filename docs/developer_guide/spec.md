# 仕様概要（MVP）

## 目的
友達同士で集まったときに、採点対象（例: M-1の出場者）を各自が採点し、
- 全員合計の合計点と順位
- 各参加者ごとの順位
を各々のスマホから確認できる。

## 用語
- **イベント**: みんなで採点する会（例: M-1 2025 決勝）
- **採点対象**: イベント内で採点される対象（例: 出場者）
- **参加者**: スマホからアクセスして採点する人

## 画面（最小）
- 採点イベント作成（タイトル、採点対象のリスト）
- 採点イベント参加（イベントID、名前）
- 採点（各対象の点数入力）
- 結果表示
  - 全員合計: 採点対象ごとの合計点と順位
  - 参加者別: 採点対象ごとの点数と順位

### 参加者向けリンク（MVP）
- 主催者は「イベントIDを含むリンク」を参加者へ送る。
  - 例: `https://<host>/?eventId=<イベントID>`
- 参加者が上記リンクでアクセスした場合、イベント作成/参加の独立画面は表示せず、**採点入力画面** と **結果表示画面** を表示する。
- ただし初回アクセス時など未参加の場合は、採点入力画面内に **参加（ニックネーム）** の入力UIを表示し、そこで参加登録できる（参加登録は採点をブロックしない）。
- 参加者が一度「参加」した後は、その参加者向けのリンク（次回は名前入力なしで採点できる）を表示する。
  - 例: `https://<host>/?eventId=<イベントID>#name=<参加者名>&voter=<参加者トークン>`
- 併せて、他の参加者を招待するための「イベントIDのみのリンク」も表示できる。

## 採点ルール
- 点数は整数
- 未入力は 0 点として扱う。

## 入力ルール（MVP）
- イベントタイトル、参加者名、採点対象名は **空白のみを不可** とする（前後空白は除去して扱う）。
- 参加者名は **同一イベント内で重複不可** とする（前後空白除去後に一致する場合は参加をブロック）。
- 採点対象リストは空白行を除外し、結果が0件になる入力は不可とする。

## 順位ルール
- 高得点ほど上位。
- 同点は同順位。
- 次の順位は飛ばす。
  - (1,1,3)。

## API（概要）
本MVPは **AWS Amplify Gen 2 + AWS AppSync(GraphQL)** を本流とし、RESTではなく GraphQL API を利用する。

### 認証モード
- **ゲスト利用可（アカウント登録なし）** を前提とする。
- 認証方式は **IAM（Cognito Identity Pool の未認証ID）** を基本とし、クライアントには `IdentityId` が付与される。

### データ操作（Query/Mutation）
最小限の操作は以下とする（命名は実装で調整可）。

- イベント作成
  - `createEvent(title, candidates[])`
- イベント参加（表示名登録）
  - `createParticipant(eventId, displayName)`
- 採点（投票）
  - `upsertVote(eventId, candidateId, score)`
- 結果表示（初期ロード）
  - `listCandidates(eventId)` : 各採点対象の `totalScore` を取得
  - `listVotesByVoter(eventId)` : 自分の投票（未入力は0扱い）を取得

### リアルタイム更新（Subscription）
誰かが投票して合計点が更新されたら、参加者の画面を即時更新する。

- `onCandidateUpdated(eventId)` : `totalScore` 更新を購読

### 集計・順位計算
- 「全員合計」は **採点対象（Candidate）の `totalScore`** を表示する。
- 「順位（1,1,3方式）」は **クライアント側で計算** する（候補数が少なく計算コストが低いため）。
- 未入力は 0 点として扱う（クライアント側で必ず整数に正規化して送信/表示する）。
